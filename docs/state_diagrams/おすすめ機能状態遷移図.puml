@startuml おすすめ機能状態遷移図

title おすすめ機能 - 状態遷移図

[*] --> 待機中

state 待機中 {
  [*] --> メイン表示
}

待機中 --> 提案候補の抽出 : アプリ起動後初回にトリガー

state "おすすめ機能" as Recommendations {

  state 提案候補の抽出 {
    [*] --> フォルダスキャン
    フォルダスキャン --> フィルタリング : 写真あり
    フィルタリング --> 提案リスト作成 : 未登録ワールドあり
    
    note bottom of フィルタリング
      ユーザーが設定した日付の範囲内の写真を取得する
      その中から既存・無視リストに入っているワールドを
      除外してランダムで4件選別
    end note
  }

  提案候補の抽出 --> 提案表示 : 候補あり
  提案候補の抽出 --> 待機中 : 候補なし / 設定なし

  state 提案表示 {
    [*] --> ユーザー選択待機
    
    ユーザー選択待機 --> ワールド追加処理 : 「追加」ボタン
    ユーザー選択待機 --> 無視登録処理 : 「無視」ボタン
    
    state ワールド追加処理 {
      [*] --> API取得とDB保存
    }
    
    state 無視登録処理 {
      [*] --> 無視リストDB保存
    }

    ワールド追加処理 --> ユーザー選択待機 : 次の候補を表示
    無視登録処理 --> ユーザー選択待機 : 次の候補を表示
  }

  提案表示 --> 待機中 : メイン画面に表示する
}

待機中 --> [*] : アプリ終了
@enduml